<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>oidc-squared</title><meta name="description" content="Documentation for oidc-squared"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/search.js" id="tsd-search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base=".">
<div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<div class="field">
<div id="tsd-toolbar-links"></div></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">oidc-squared</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-content">
<div class="tsd-page-title">
<h2>oidc-squared</h2></div>
<div class="tsd-panel tsd-typography"><a id="md:oidc-squared" class="tsd-anchor"></a><h1><a href="#md:oidc-squared">OIDC-Squared</a></h1><p>The OIDC² library for Browsers.</p>
<a id="md:install" class="tsd-anchor"></a><h2><a href="#md:install">Install</a></h2><pre><code class="language-bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">oidc-squared</span>
</code><button>Copy</button></pre>
<a id="md:documentation" class="tsd-anchor"></a><h2><a href="#md:documentation">Documentation</a></h2><p>The following shows a quick introduction to the OIDC² library.
A more-detailed documentation is provided <a href="https://jonasprimbs.github.io/oidc-squared/">here</a>.</p>
<a id="md:supported-signing-algorithms" class="tsd-anchor"></a><h3><a href="#md:supported-signing-algorithms">Supported Signing Algorithms</a></h3><table>
<thead>
<tr>
<th>Algorithm</th>
<th>Supported</th>
</tr>
</thead>
<tbody><tr>
<td><code>ES256</code></td>
<td>✅</td>
</tr>
<tr>
<td><code>ES384</code></td>
<td>✅</td>
</tr>
<tr>
<td><code>ES512</code></td>
<td>✅</td>
</tr>
<tr>
<td><code>RS256</code></td>
<td>✅</td>
</tr>
<tr>
<td><code>RS384</code></td>
<td>✅</td>
</tr>
<tr>
<td><code>RS512</code></td>
<td>✅</td>
</tr>
<tr>
<td><code>PS256</code></td>
<td>✅</td>
</tr>
<tr>
<td><code>PS384</code></td>
<td>✅</td>
</tr>
<tr>
<td><code>PS512</code></td>
<td>✅</td>
</tr>
<tr>
<td><code>EdDSA</code></td>
<td>❌</td>
</tr>
</tbody></table>
<a id="md:coding-examples" class="tsd-anchor"></a><h2><a href="#md:coding-examples">Coding Examples</a></h2><a id="md:generate-client-key-pair" class="tsd-anchor"></a><h3><a href="#md:generate-client-key-pair">Generate Client Key Pair</a></h3><p>Use Web Crypto API to generate an asymmetric key pair:</p>
<pre><code class="language-typescript"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">clientKeyPair</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-6">crypto</span><span class="hl-1">.</span><span class="hl-6">subtle</span><span class="hl-1">.</span><span class="hl-0">generateKey</span><span class="hl-1">(</span><br/><span class="hl-1">  { </span><span class="hl-6">name:</span><span class="hl-1"> </span><span class="hl-2">&#39;ECDSA&#39;</span><span class="hl-1">, </span><span class="hl-6">namedCurve:</span><span class="hl-1"> </span><span class="hl-2">&#39;P-384&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-3">false</span><span class="hl-1">,</span><br/><span class="hl-1">  [</span><span class="hl-2">&#39;sign&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;verify&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<p>For more examples see <a href="./examples/key-pair-generation.md">key pair generation examples</a>.</p>
<a id="md:proof-of-possession-token" class="tsd-anchor"></a><h3><a href="#md:proof-of-possession-token">Proof-of-Possession Token</a></h3><a id="md:pop-token-generation" class="tsd-anchor"></a><h4><a href="#md:pop-token-generation">PoP Token Generation</a></h4><p>A PoP Token is typically generated on the Client using the following code:</p>
<pre><code class="language-typescript"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">NonceGenerators</span><span class="hl-1">, </span><span class="hl-6">SignPoPToken</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;oidc-squared&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">// Export the JWK public key:</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">publicJwk</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-6">crypto</span><span class="hl-1">.</span><span class="hl-6">subtle</span><span class="hl-1">.</span><span class="hl-0">exportKey</span><span class="hl-1">(</span><span class="hl-2">&#39;jwk&#39;</span><span class="hl-1">, </span><span class="hl-6">clientKeyPair</span><span class="hl-1">.</span><span class="hl-6">publicKey</span><span class="hl-1">);</span><br/><br/><span class="hl-7">// Create a new PoP Token:</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">popToken</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">SignPoPToken</span><span class="hl-1">() </span><span class="hl-7">// Also sets &quot;iat&quot; to now, &quot;exp&quot; to in 60 seconds, and &quot;jti&quot; to a new UUID.</span><br/><span class="hl-1">  .</span><span class="hl-0">setPublicKey</span><span class="hl-1">(</span><span class="hl-2">&#39;ES384&#39;</span><span class="hl-1">, </span><span class="hl-6">publicJwk</span><span class="hl-1">)       </span><span class="hl-7">// Sets the public key and its algorithm.</span><br/><span class="hl-1">  .</span><span class="hl-0">setIssuer</span><span class="hl-1">(</span><span class="hl-2">&#39;myclient&#39;</span><span class="hl-1">)                  </span><span class="hl-7">// Sets Issuer (= Client ID).</span><br/><span class="hl-1">  .</span><span class="hl-0">setSubject</span><span class="hl-1">(</span><span class="hl-2">&#39;alice&#39;</span><span class="hl-1">)                    </span><span class="hl-7">// Sets Subject (= End-User&#39;s Subject ID).</span><br/><span class="hl-1">  .</span><span class="hl-0">setAudience</span><span class="hl-1">(</span><span class="hl-2">&#39;https://op.example.com&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Sets Audience (= OpenID Provider&#39;s Issuer URL).</span><br/><span class="hl-1">  .</span><span class="hl-0">sign</span><span class="hl-1">(</span><span class="hl-6">clientKeyPair</span><span class="hl-1">.</span><span class="hl-6">privateKey</span><span class="hl-1">);        </span><span class="hl-7">// Signs the PoP Token asynchronously and returns its token string.</span>
</code><button>Copy</button></pre>
<p>For more detailled examples, see <a href="./examples/pop-token-generation.md">PoP Token Generation examples</a>.</p>
<a id="md:pop-token-verification" class="tsd-anchor"></a><h4><a href="#md:pop-token-verification">PoP Token Verification</a></h4><p>A PoP Token is typically generated on the OpenID Provider using the following code:</p>
<pre><code class="language-typescript"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">popTokenVerify</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;oidc-squared&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">// Verify and parse the PoP Token:</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">popResult</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">popTokenVerify</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-6">popToken</span><span class="hl-1">,               </span><span class="hl-7">// The PoP Token to parse and verify.</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-6">issuer:</span><span class="hl-1"> </span><span class="hl-6">clientId</span><span class="hl-1">,     </span><span class="hl-7">// Set expected Issuer (= Client ID) or leave empty to accept all (NOT RECOMMENDED!).</span><br/><span class="hl-1">      </span><span class="hl-6">subject:</span><span class="hl-1"> </span><span class="hl-6">subject</span><span class="hl-1">,     </span><span class="hl-7">// Set expected Subject (= End-User&#39;s Subject ID) or leave empty to accept all (NOT RECOMMENDED!).</span><br/><span class="hl-1">      </span><span class="hl-6">audience:</span><span class="hl-1"> </span><span class="hl-6">opBaseUrl</span><span class="hl-1">,  </span><span class="hl-7">// (REQUIRED) Set expected Audience (= OpenID Provider&#39;s Issuer URL).</span><br/><span class="hl-1">      </span><span class="hl-6">maxTokenAge:</span><span class="hl-1"> </span><span class="hl-8">300</span><span class="hl-1">,     </span><span class="hl-7">// Maximum accepted age of the PoP Token in seconds. 300 seconds (= 5 minutes) is the maximum recommended value.</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  );</span><br/><br/><span class="hl-1">  </span><span class="hl-7">// Extract the parsed header and payload from the PoP Token:</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">popHeader</span><span class="hl-1"> = </span><span class="hl-6">popResult</span><span class="hl-1">.</span><span class="hl-6">protectedHeader</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">popPayload</span><span class="hl-1"> = </span><span class="hl-6">popResult</span><span class="hl-1">.</span><span class="hl-6">payload</span><span class="hl-1">;</span><br/><span class="hl-1">} </span><span class="hl-5">catch</span><span class="hl-1"> (</span><span class="hl-6">e</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">// Error will be thrown if token verification fails.</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:identity-certification-token" class="tsd-anchor"></a><h3><a href="#md:identity-certification-token">Identity Certification Token</a></h3><a id="md:ict-request" class="tsd-anchor"></a><h4><a href="#md:ict-request">ICT Request</a></h4><p>An ICT is typically requested by the Client from the OpenID Provider using the following code:</p>
<pre><code class="language-typescript"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">getIctEndpoint</span><span class="hl-1">, </span><span class="hl-6">requestIct</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;oidc-squared&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">// If not yet known, you can request the ICT Endpoint from the Discovery Document:</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">ictEndpoint</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">getIctEndpoint</span><span class="hl-1">(</span><span class="hl-2">&#39;https://op.example.com&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-7">// Request ICT from ICT Endpoint:</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">ictResponse</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">requestIct</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-6">ictEndPoint:</span><span class="hl-1"> </span><span class="hl-6">ictEndpoint</span><span class="hl-1">,   </span><span class="hl-7">// Provide ICT Endpoint here.</span><br/><span class="hl-1">  </span><span class="hl-6">accessToken:</span><span class="hl-1"> </span><span class="hl-2">&#39;ey...&#39;</span><span class="hl-1">,       </span><span class="hl-7">// Insert Access Token for authorization here.</span><br/><span class="hl-1">  </span><span class="hl-6">popToken:</span><span class="hl-1"> </span><span class="hl-6">popToken</span><span class="hl-1">,         </span><span class="hl-7">// Insert previously generated PoP Token here.</span><br/><span class="hl-1">  </span><span class="hl-6">requiredClaims:</span><span class="hl-1"> [</span><span class="hl-2">&#39;name&#39;</span><span class="hl-1">],   </span><span class="hl-7">// Insert all REQUIRED identity claims you want to be provided in the ICT here.</span><br/><span class="hl-1">  </span><span class="hl-6">optionalClaims:</span><span class="hl-1"> [</span><span class="hl-2">&#39;email&#39;</span><span class="hl-1">],  </span><span class="hl-7">// Insert all OPTIONAL identity claims you want to be provided in the ICT here.</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">// The ICT can be found in the identity_certification_token parameter of the response.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">ict</span><span class="hl-1"> = </span><span class="hl-6">ictResponse</span><span class="hl-1">.</span><span class="hl-6">identity_certification_token</span><span class="hl-1">;</span>
</code><button>Copy</button></pre>
<a id="md:ict-generation" class="tsd-anchor"></a><h4><a href="#md:ict-generation">ICT Generation</a></h4><p>An ICT is typically generated on the OpenID Provider using the following code:</p>
<pre><code class="language-typescript"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">SignICT</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;oidc-squared&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">// Create a new ICT:</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">ict</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">SignICT</span><span class="hl-1">()         </span><span class="hl-7">// Also sets &quot;iat&quot; to now, &quot;exp&quot; to in 300 seconds, and &quot;jti&quot; to a new UUID.</span><br/><span class="hl-1">  .</span><span class="hl-0">setKeyId</span><span class="hl-1">(</span><span class="hl-2">&#39;RS384&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;key#1&#39;</span><span class="hl-1">)           </span><span class="hl-7">// Sets the Key ID and its algorithm.</span><br/><span class="hl-1">  .</span><span class="hl-0">setIssuer</span><span class="hl-1">(</span><span class="hl-2">&#39;https://op.example.com&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Sets Issuer (= OpenID Provider&#39;s Issuer URL).</span><br/><span class="hl-1">  .</span><span class="hl-0">setSubject</span><span class="hl-1">(</span><span class="hl-2">&#39;alice&#39;</span><span class="hl-1">)                  </span><span class="hl-7">// Sets Subject (= End-User&#39;s Subject ID).</span><br/><span class="hl-1">  .</span><span class="hl-0">setAudience</span><span class="hl-1">(</span><span class="hl-2">&#39;myclient&#39;</span><span class="hl-1">)              </span><span class="hl-7">// (OPTIONAL) Sets Audience (= Client ID).</span><br/><span class="hl-1">  .</span><span class="hl-0">setConfirmation</span><span class="hl-1">(</span><span class="hl-6">popResult</span><span class="hl-1">.</span><span class="hl-6">protectedHeader</span><span class="hl-1">.</span><span class="hl-6">jwk</span><span class="hl-1">) </span><span class="hl-7">// Sets Confirmation (= Client&#39;s Public Key).</span><br/><span class="hl-1">  .</span><span class="hl-0">setContext</span><span class="hl-1">([</span><span class="hl-2">&#39;app-1&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;app-2&#39;</span><span class="hl-1">])       </span><span class="hl-7">// Set the granted e2e authentication contexts.</span><br/><span class="hl-1">  .</span><span class="hl-0">sign</span><span class="hl-1">(</span><span class="hl-6">opKeyPair</span><span class="hl-1">.</span><span class="hl-6">privateKey</span><span class="hl-1">);          </span><span class="hl-7">// Signs the ICT asynchronously and returns its token string.</span>
</code><button>Copy</button></pre>
<p>For more detailled examples, see <a href="./examples/ict-generation.md">ICT Generation examples</a>.</p>
<a id="md:ict-verification" class="tsd-anchor"></a><h4><a href="#md:ict-verification">ICT Verification</a></h4><p>An ICT is typically verified on the Authenticating Party using the following code:</p>
<pre><code class="language-typescript"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">ictVerify</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;oidc-squared&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">// Verify and parse the ICT:</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">ictResult</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">ictVerify</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-6">ict</span><span class="hl-1">,                                </span><span class="hl-7">// The ICT to parse and verify.</span><br/><span class="hl-1">    </span><span class="hl-6">opKeyPair</span><span class="hl-1">.</span><span class="hl-6">publicKey</span><span class="hl-1">,                </span><span class="hl-7">// Public Key of the OpenID Provider to verify the signature with.</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-6">issuer:</span><span class="hl-1"> </span><span class="hl-2">&#39;https://op.example.com&#39;</span><span class="hl-1">, </span><span class="hl-7">// Set expected Issuer (= OpenID Provider&#39;s Issuer URL) or leave empty to accept all (NOT RECOMMENDED!).</span><br/><span class="hl-1">      </span><span class="hl-6">subject:</span><span class="hl-1"> </span><span class="hl-2">&#39;alice&#39;</span><span class="hl-1">,                 </span><span class="hl-7">// Set expected Subject (= End-User&#39;s Subject ID) or leave empty to accept all (NOT RECOMMENDED!).</span><br/><span class="hl-1">      </span><span class="hl-6">audience:</span><span class="hl-1"> </span><span class="hl-2">&#39;myclient&#39;</span><span class="hl-1">,             </span><span class="hl-7">// (OPTIONAL) Set expected Audience (= Client ID of Client) or leave empty to accept all.</span><br/><span class="hl-1">      </span><span class="hl-6">maxTokenAge:</span><span class="hl-1"> </span><span class="hl-8">3600</span><span class="hl-1">,                </span><span class="hl-7">// Maximum accepted age of the PoP Token in seconds. 3600 seconds (= 1 hour) is the maximum recommended value.</span><br/><span class="hl-1">      </span><span class="hl-6">requiredContext:</span><span class="hl-1"> [</span><span class="hl-2">&#39;app-1&#39;</span><span class="hl-1">],       </span><span class="hl-7">// Required e2e authentication contexts.</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  );</span><br/><br/><span class="hl-1">  </span><span class="hl-7">// Extract the parsed header and payload from the ICT:</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">ictHeader</span><span class="hl-1"> = </span><span class="hl-6">ictResult</span><span class="hl-1">.</span><span class="hl-6">protectedHeader</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">ictPayload</span><span class="hl-1"> = </span><span class="hl-6">ictResult</span><span class="hl-1">.</span><span class="hl-6">payload</span><span class="hl-1">;</span><br/><span class="hl-1">} </span><span class="hl-5">catch</span><span class="hl-1"> (</span><span class="hl-6">e</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">// Error will be thrown if token verification fails.</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:end-to-end-proof-of-possession-token" class="tsd-anchor"></a><h3><a href="#md:end-to-end-proof-of-possession-token">End-to-End Proof-of-Possession Token</a></h3><a id="md:e2e-pop-token-generation" class="tsd-anchor"></a><h4><a href="#md:e2e-pop-token-generation">E2E PoP Token Generation</a></h4><p>An E2E PoP Token is typically generated by the Client using the following code:</p>
<pre><code class="language-typescript"><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-3">*</span><span class="hl-1"> </span><span class="hl-5">as</span><span class="hl-1"> </span><span class="hl-6">jose</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;jose&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">SignE2EPoPToken</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;oidc-squared&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">// Calculate the JWK Thumbprint from the Client&#39;s public key.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">jkt</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-6">jose</span><span class="hl-1">.</span><span class="hl-0">calculateJwkThumbprint</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-6">jose</span><span class="hl-1">.</span><span class="hl-0">exportJWK</span><span class="hl-1">(</span><span class="hl-6">clientKeyPair</span><span class="hl-1">.</span><span class="hl-6">publicKey</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-2">&#39;sha256&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-7">// Create a new E2E PoP Token:</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">e2ePoPToken</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">SignE2EPoPToken</span><span class="hl-1">() </span><span class="hl-7">// Also sets &quot;iat&quot; to now, &quot;exp&quot; to in 300 seconds, and &quot;jti&quot; to a new UUID.</span><br/><span class="hl-1">  .</span><span class="hl-0">setThumbprint</span><span class="hl-1">(</span><span class="hl-2">&#39;ES384&#39;</span><span class="hl-1">, </span><span class="hl-6">jkt</span><span class="hl-1">)                  </span><span class="hl-7">// Sets the JWK Thumbprint and its algorithm.</span><br/><span class="hl-1">  .</span><span class="hl-0">setIssuer</span><span class="hl-1">(</span><span class="hl-2">&#39;myclient&#39;</span><span class="hl-1">)                        </span><span class="hl-7">// Sets Issuer (= Client&#39;s Client ID).</span><br/><span class="hl-1">  .</span><span class="hl-0">setSubject</span><span class="hl-1">(</span><span class="hl-6">subject</span><span class="hl-1">)                          </span><span class="hl-7">// Sets Subject (= End-User&#39;s Subject ID).</span><br/><span class="hl-1">  .</span><span class="hl-0">setAudience</span><span class="hl-1">(</span><span class="hl-2">&#39;sessionid&#39;</span><span class="hl-1">)                     </span><span class="hl-7">// Sets Audience (= Session ID, User ID, or Client ID that the Authenticating Party uniquely identifies with).</span><br/><span class="hl-1">  .</span><span class="hl-0">sign</span><span class="hl-1">(</span><span class="hl-6">clientKeyPair</span><span class="hl-1">.</span><span class="hl-6">privateKey</span><span class="hl-1">);              </span><span class="hl-7">// Signs the ICT asynchronously and returns its token string.</span>
</code><button>Copy</button></pre>
<p>For more detailled examples, see <a href="./examples/e2e-pop-token-generation.md">E2E PoP Generation examples</a>.</p>
<a id="md:e2e-pop-token-verification" class="tsd-anchor"></a><h4><a href="#md:e2e-pop-token-verification">E2E PoP Token Verification</a></h4><p>An E2E PoP Token is typically verified by the Authenticating Party using the following code:</p>
<pre><code class="language-typescript"><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-3">*</span><span class="hl-1"> </span><span class="hl-5">as</span><span class="hl-1"> </span><span class="hl-6">jose</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;jose&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">e2ePoPTokenVerify</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;oidc-squared&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">// Import the public key from the ICT&#39;s confirmation claim:</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">clientPublicKey</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-6">jose</span><span class="hl-1">.</span><span class="hl-0">importJWK</span><span class="hl-1">(</span><span class="hl-6">ictPayload</span><span class="hl-1">.</span><span class="hl-6">cnf</span><span class="hl-1">.</span><span class="hl-6">jwk</span><span class="hl-1">);</span><br/><br/><span class="hl-5">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">// Verify and parse the E2E PoP Token:</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">e2ePoPResult</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">e2ePoPTokenVerify</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-6">e2ePoPToken</span><span class="hl-1">,                      </span><span class="hl-7">// The E2E PoP Token to parse and verify.</span><br/><span class="hl-1">    </span><span class="hl-6">clientPublicKey</span><span class="hl-1">,                  </span><span class="hl-7">// Imported Public Key of the public key.</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-6">issuer:</span><span class="hl-1"> </span><span class="hl-6">ictResult</span><span class="hl-1">.</span><span class="hl-6">payload</span><span class="hl-1">.</span><span class="hl-6">aud</span><span class="hl-1">,  </span><span class="hl-7">// Set expected Issuer (= Client ID of Client) or leave empty to accept all. If the audience claim in the ICT is provided, it MUST match it!</span><br/><span class="hl-1">      </span><span class="hl-6">subject:</span><span class="hl-1"> </span><span class="hl-6">ictResult</span><span class="hl-1">.</span><span class="hl-6">payload</span><span class="hl-1">.</span><span class="hl-6">sub</span><span class="hl-1">, </span><span class="hl-7">// Set expected Subject (= End-User&#39;s Subject ID). It MUST match the subject claim from the ICT!</span><br/><span class="hl-1">      </span><span class="hl-6">audience:</span><span class="hl-1"> </span><span class="hl-2">&#39;sessionid&#39;</span><span class="hl-1">,          </span><span class="hl-7">// Set expected audience.</span><br/><span class="hl-1">      </span><span class="hl-6">maxTokenAge:</span><span class="hl-1"> </span><span class="hl-8">3600</span><span class="hl-1">,              </span><span class="hl-7">// Maximum accepted age of the E2E PoP Token in seconds. 3600 seconds (= 1 hour) is the maximum recommended value.</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  );</span><br/><br/><span class="hl-1">  </span><span class="hl-7">// Extract the parsed header and payload from the E2E PoP Token:</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">e2ePoPHeader</span><span class="hl-1"> = </span><span class="hl-6">e2ePoPResult</span><span class="hl-1">.</span><span class="hl-6">protectedHeader</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">e2ePoPPayload</span><span class="hl-1"> = </span><span class="hl-6">e2ePoPResult</span><span class="hl-1">.</span><span class="hl-6">payload</span><span class="hl-1">;</span><br/><span class="hl-1">} </span><span class="hl-5">catch</span><span class="hl-1"> (</span><span class="hl-6">e</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">// Error will be thrown if token verification fails.</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
</div></div>
<div class="col-sidebar">
<div class="page-menu">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)" id="icon-chevronDown"></path></svg>Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="#icon-chevronDown"></use></svg>On This Page</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li>
<ul>
<li><a href="#md:oidc-squared"><span>OIDC-<wbr/>Squared</span></a></li>
<li>
<ul>
<li><a href="#md:install"><span>Install</span></a></li>
<li><a href="#md:documentation"><span>Documentation</span></a></li>
<li>
<ul>
<li><a href="#md:supported-signing-algorithms"><span>Supported <wbr/>Signing <wbr/>Algorithms</span></a></li></ul></li>
<li><a href="#md:coding-examples"><span>Coding <wbr/>Examples</span></a></li>
<li>
<ul>
<li><a href="#md:generate-client-key-pair"><span>Generate <wbr/>Client <wbr/>Key <wbr/>Pair</span></a></li>
<li><a href="#md:proof-of-possession-token"><span>Proof-<wbr/>of-<wbr/>Possession <wbr/>Token</span></a></li>
<li>
<ul>
<li><a href="#md:pop-token-generation"><span>Po<wbr/>P <wbr/>Token <wbr/>Generation</span></a></li>
<li><a href="#md:pop-token-verification"><span>Po<wbr/>P <wbr/>Token <wbr/>Verification</span></a></li></ul></li>
<li><a href="#md:identity-certification-token"><span>Identity <wbr/>Certification <wbr/>Token</span></a></li>
<li>
<ul>
<li><a href="#md:ict-request"><span>ICT <wbr/>Request</span></a></li>
<li><a href="#md:ict-generation"><span>ICT <wbr/>Generation</span></a></li>
<li><a href="#md:ict-verification"><span>ICT <wbr/>Verification</span></a></li></ul></li>
<li><a href="#md:end-to-end-proof-of-possession-token"><span>End-<wbr/>to-<wbr/>End <wbr/>Proof-<wbr/>of-<wbr/>Possession <wbr/>Token</span></a></li>
<li>
<ul>
<li><a href="#md:e2e-pop-token-generation"><span>E2<wbr/>E <wbr/>Po<wbr/>P <wbr/>Token <wbr/>Generation</span></a></li>
<li><a href="#md:e2e-pop-token-verification"><span>E2<wbr/>E <wbr/>Po<wbr/>P <wbr/>Token <wbr/>Verification</span></a></li></ul></li></ul></li></ul></li></ul></li></ul></div></details></div>
<div class="site-menu">
<nav class="tsd-navigation"><a href="index.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><g id="icon-4"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-namespace)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6"></rect><path d="M9.33 16V7.24H10.77L13.446 14.74C13.43 14.54 13.41 14.296 13.386 14.008C13.37 13.712 13.354 13.404 13.338 13.084C13.33 12.756 13.326 12.448 13.326 12.16V7.24H14.37V16H12.93L10.266 8.5C10.282 8.692 10.298 8.936 10.314 9.232C10.33 9.52 10.342 9.828 10.35 10.156C10.366 10.476 10.374 10.784 10.374 11.08V16H9.33Z" fill="var(--color-text)"></path></g></svg><span>oidc-<wbr/>squared</span></a>
<ul class="tsd-small-nested-navigation">
<li><a href="modules/errors.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>errors</span></a></li>
<li><a href="modules/errors_e2e_pop_token_invalid_class.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>errors/e2e-<wbr/>pop-<wbr/>token-<wbr/>invalid.class</span></a></li>
<li><a href="modules/errors_ict_invalid_class.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>errors/ict-<wbr/>invalid.class</span></a></li>
<li><a href="modules/errors_oidc_squared_not_supported_error_class.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>errors/oidc-<wbr/>squared-<wbr/>not-<wbr/>supported-<wbr/>error.class</span></a></li>
<li><a href="modules/errors_pop_token_invalid_class.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>errors/pop-<wbr/>token-<wbr/>invalid.class</span></a></li>
<li><a href="modules/nonce_generators.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>nonce-<wbr/>generators</span></a></li>
<li><a href="modules/nonce_generators_base64_nonce_generator_class.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>nonce-<wbr/>generators/base64-<wbr/>nonce-<wbr/>generator.class</span></a></li>
<li><a href="modules/nonce_generators_base64_nonce_generator_class_test.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>nonce-<wbr/>generators/base64-<wbr/>nonce-<wbr/>generator.class.test</span></a></li>
<li><a href="modules/nonce_generators_custom_nonce_generator_class.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>nonce-<wbr/>generators/custom-<wbr/>nonce-<wbr/>generator.class</span></a></li>
<li><a href="modules/nonce_generators_custom_nonce_generator_class_test.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>nonce-<wbr/>generators/custom-<wbr/>nonce-<wbr/>generator.class.test</span></a></li>
<li><a href="modules/nonce_generators_nonce_generator_class.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>nonce-<wbr/>generators/nonce-<wbr/>generator.class</span></a></li>
<li><a href="modules/nonce_generators_nonce_generators_class.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>nonce-<wbr/>generators/nonce-<wbr/>generators.class</span></a></li>
<li><a href="modules/nonce_generators_nonce_generators_class_test.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>nonce-<wbr/>generators/nonce-<wbr/>generators.class.test</span></a></li>
<li><a href="modules/nonce_generators_uuid_nonce_generator_class.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>nonce-<wbr/>generators/uuid-<wbr/>nonce-<wbr/>generator.class</span></a></li>
<li><a href="modules/nonce_generators_uuid_nonce_generator_class_test.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>nonce-<wbr/>generators/uuid-<wbr/>nonce-<wbr/>generator.class.test</span></a></li>
<li><a href="modules/rest.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>rest</span></a></li>
<li><a href="modules/rest_get_ict_endpoint_function.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>rest/get-<wbr/>ict-<wbr/>endpoint.function</span></a></li>
<li><a href="modules/rest_request_ict_function.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>rest/request-<wbr/>ict.function</span></a></li>
<li><a href="modules/tokens.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>tokens</span></a></li>
<li><a href="modules/tokens_e2e_pop_token.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>tokens/e2e-<wbr/>pop-<wbr/>token</span></a></li>
<li><a href="modules/tokens_identity_certification_token.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>tokens/identity-<wbr/>certification-<wbr/>token</span></a></li>
<li><a href="modules/tokens_proof_of_possession_token.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>tokens/proof-<wbr/>of-<wbr/>possession-<wbr/>token</span></a></li>
<li><a href="modules/types.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>types</span></a></li>
<li><a href="modules/types_asymmetric_pop_confirmation_object_interface.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>types/asymmetric-<wbr/>pop-<wbr/>confirmation-<wbr/>object.interface</span></a></li>
<li><a href="modules/types_asymmetric_signing_algorithms_type.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>types/asymmetric-<wbr/>signing-<wbr/>algorithms.type</span></a></li>
<li><a href="modules/types_confirmation_object_type.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>types/confirmation-<wbr/>object.type</span></a></li></ul></nav></div></div></div>
<div class="tsd-generator">
<p>Generated using <a href="https://typedoc.org/" rel="noopener" target="_blank">TypeDoc</a></p></div>
<div class="overlay"></div></body></html>